---
title: "UKAlc_Merging_Descriptives"
author: "Anna Patterson"
date: "2023-09-28"
output: html_document
---

rm(list = ls())
```{r}
#libraries
library(tidyverse)
library(dplyr)
library(tidyr)
library(stringr)
library(janitor)
library(lubridate)
library(lme4)
library(nlme)
library(lmerTest) #to extract P values when lmer doesnt feel like showing them
library(performance) #to extract ICCs
library(emmeans) #for plotting interactions
knitr::opts_chunk$set(echo = TRUE)
library(ggpubr)
library(ggplot2)
library(ggdist)
library(ggrain)
library(zoo)


#Anisha's Paths

# 
# am_qual <- read.csv("C:/Users/anish/Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/UKALC/02_datasets/UKALC_DAILY/02_data_prep_workspace/AM_Qualtrics_csv.csv")
# 
# pm_qual <- read.csv("C:/Users/anish/Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/UKALC/02_datasets/UKALC_DAILY/02_data_prep_workspace/PM_Qualtrics_csv.csv")
# 
# am_rc <- read.csv("C:/Users/anish/Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/UKALC/02_datasets/UKALC_DAILY/02_data_prep_workspace/AM_REDCap_csv.csv")
# 
# pm_rc <- read.csv("C:/Users/anish/Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/UKALC/02_datasets/UKALC_DAILY/02_data_prep_workspace/PM_REDCap_csv.csv")


#Anna's Paths (jb updated to ~)

am_qual <- read.csv("~/Library/CloudStorage/Box-Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/UKALC/02_datasets/UKALC_DAILY/02_data_prep_workspace/AM_Qualtrics_csv.csv")

pm_qual <- read.csv("~/Library/CloudStorage/Box-Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/UKALC/02_datasets/UKALC_DAILY/02_data_prep_workspace/PM_Qualtrics_csv.csv")

am_rc <- read.csv("~/Library/CloudStorage/Box-Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/UKALC/02_datasets/UKALC_DAILY/02_data_prep_workspace/AM_REDCap_csv.csv")

pm_rc <- read.csv("~/Library/CloudStorage/Box-Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/UKALC/02_datasets/UKALC_DAILY/02_data_prep_workspace/PM_REDCap_csv.csv")
```

ID's in am_qual: 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 126

ID's in a_rc: [1] "123"       "124"       "125"       "125b"      "125c"      "125d"      "127"       "127 (new)" "128"      
[10] "129"       "130"       "131"       "132"       "133"       "134"       "134b"      "135"       "136"      
[19] "138"       "139"       "139b"      "140"       "141"       "142"       "142b"      "143"       "144"      
[28] "145"       "146"       "147"       "148"       "149"       "150"       "152"       "153"       "154"      
[37] "155"       "156"       "157"       "158"       "159"       "160"       "161"       "162"       "163"      
[46] "164"       "165"       "166"       "166a"      "166b"      "167"       "168"       "169"       "170"      
[55] "171"       "172"       "173"       "174"       "175"       "176"       "177"       "178"       "179"      
[64] "180"       "181"       "182"       "183"       "184"       "185"   

ID's in pm_qual: 101 102 103 104 105 106 107 108 109 111 112 113 114 115 116 117 118 119 120 121 122 126 

ID's in pm_rc: [1] "123"       "124"       "125"       "125b"      "125c"      "125d"      "127"       "127 (new)" "128"      
[10] "129"       "130"       "131"       "132"       "133"       "134"       "134b"      "135"       "136"      
[19] "138"       "139"       "139b"      "140"       "141"       "142"       "142b"      "143"       "144"      
[28] "145"       "146"       "147"       "148"       "149"       "150"       "152"       "153"       "154"      
[37] "155"       "156"       "157"       "158"       "159"       "160"       "161"       "162"       "163"      
[46] "164"       "165"       "166"       "166a"      "166b"      "167"       "168"       "169"       "170"      
[55] "171"       "172"       "173"       "174"       "175"       "176"       "177"       "178"       "179"      
[64] "180"       "181"       "182"       "183"       "184"       "185"    



#IDs in am qualtrics are numerical, IDs in rc are string form -- letters at end of some IDs indicate different sessions of same participant 
```{r}
am_data <- merge(am_qual, am_rc, by = c("ID", "DateTime"), all = T)

pm_data <- merge(pm_qual, pm_rc, by = c("ID", "DateTime"), all = T)

```
#view overlap between am and pm data 
#See how many unique IDs are in each dataset 
```{r}
intersect(am_data$ID, pm_data$ID)

setdiff(am_data$ID, pm_data$ID)

am_pm_part <- intersect(am_data$ID, pm_data$ID)
length(am_pm_part)

am_data$ID <- gsub("[^0-9.-]", "", am_data$ID)
pm_data$ID <- gsub("[^0-9.-]", "", pm_data$ID)

#seeing how many IDs are in each data set, viewed the output and saw they included NA in the calculation, so subtracted 1 from final calculation 
length(unique(am_data$ID))
length(unique(pm_data$ID))
```

#Before correcting for duplicates, we have n = 83 for am data and n = 82 for pm data 

```{r}
#separate datetime variable 
am_data[c('daterated', 'time')] <- str_split_fixed(am_data$DateTime, ' ', 2)
pm_data[c('daterated', 'time')] <- str_split_fixed(pm_data$DateTime, ' ', 2)
```

```{r}
#first step change time character to a time-realized variable 
pm_data$time <- lubridate::hm(pm_data$time)
pm_data$daterated <- lubridate::mdy(pm_data$daterated)

#flag observations that were done before 12pm 
pm_data <- pm_data %>% mutate(pm_data, b4noon = ifelse(time < lubridate::hm("12:00"),1, 0)) 

#if b4noon = 1, change pm_data$daterated - 1

pm_data <- pm_data %>%
  mutate(daterated = case_when(
    b4noon == 1 ~ daterated -1,
    TRUE ~ daterated
  ))
```

```{r}
#Transform daterated into a date variable in am_data as well so R can recognize as date variable

am_data$daterated <- lubridate::mdy(am_data$daterated)

#Remove DateTime column from df 
am_data = subset(am_data, select = -c(DateTime))

```

```{r}
replace_empty_with_na <- function(data) {
  data %>% mutate_if(is.character, ~ ifelse(. == "", NA, .))
}

xymerge <- function(dat) {
  # Create a logical vector indicating which column names end in ".x"
  x_cols <- grepl("\\.x$", names(dat))
  
  # Loop over each x column and apply the ifelse function
  for (x_col in names(dat)[x_cols]) {
    # Extract the corresponding y column name
    y_col <- gsub("\\.x$", ".y", x_col)
    
    # Create a new column name by removing the .x suffix
    new_col <- gsub("\\.x$", "", x_col)
    
    # Apply the ifelse function to the x and y columns and assign the result to the new column
    dat[[new_col]] <- ifelse(is.na(dat[[x_col]]), dat[[y_col]], dat[[x_col]])
    
    # Remove the x and y columns from the dataframe
    dat[[x_col]] <- NULL
    dat[[y_col]] <- NULL
  }
  
  # Return the updated data frame
  return(dat)
}
#replace empty with NA so they're coded the same for subsequent functions 
am_data <- replace_empty_with_na(am_data)
pm_data <- replace_empty_with_na(pm_data)
#consolidate xy variable names that existed as a byproduct of merging the two datasets with the same column names
am_data <- xymerge(am_data)
pm_data <- xymerge(pm_data)
```

#relocate daterated to be after ID and remove time column 
```{r}
am_data <- am_data %>% 
  relocate(daterated, .after = ID) 
pm_data <- pm_data %>% 
  relocate(daterated, .after = ID) 
```

```{r}
#Add _am and _pm suffixes to each dataset 
colnames(am_data) <- paste(colnames(am_data), "am", sep="_")

colnames(pm_data) <- paste(colnames(pm_data), "pm", sep="_")
```

```{r}
#rename daterated and ID to drop the _am and _pm suffixes 
colnames(am_data)[colnames(am_data) == "daterated_am"] ="daterated"
colnames(pm_data)[colnames(pm_data) == "daterated_pm"] ="daterated"

colnames(am_data)[colnames(am_data) == "ID_am"] ="ID"
colnames(pm_data)[colnames(pm_data) == "ID_pm"] ="ID"
```

#Remove rows where everything is NA except daterated, time, and ID
```{r}
am_data <- am_data %>% drop_na(daterated, ID)
pm_data <- pm_data %>% drop_na(daterated, ID)
```

#Remove X_pm column from pm_data 
```{r}
pm_data = subset(pm_data, select=-c(X_pm))
```

#drop ID 127 per Annie Griffith's recommendation (not much data for this ID)
```{r}

am_data <- subset(am_data, ID != 127)

pm_data <- subset(pm_data, ID != 127)

```

#Find Duplicates in Dates per ID for am_data
```{r}
result.am <- am_data %>%
  group_by(ID, daterated) %>%
  summarise(observations = n())

dupdate_am <- subset(result.am, observations != 1)
dupdate_am

result.pm <- pm_data %>%
  group_by(ID, daterated) %>%
  summarise(observations = n())

dupdate_pm <- subset(result.pm, observations != 1)
dupdate_pm
```

#Remove am_data rows so that we no longer have >1 submission per am or pm data per date. Kept earliest timestamp if all submissions are identical, or kept most complete form if some are more completed than others. 
```{r}
#remove duplicates for 106 on 2021-05-09 
am_data %>%
  filter(ID == 106 & daterated == ymd("2021-05-09"))

am_data <- am_data[!(am_data$ID == 106 & am_data$daterated == "2021-05-09" & am_data$time_am == "10:02"), ]
am_data <- am_data[!(am_data$ID == 106 & am_data$daterated == "2021-05-09" & am_data$time_am == "9:59"), ]

#remove duplicates for 106 on 2021-05-18 
am_data <- am_data[!(am_data$ID == 106 & am_data$daterated == "2021-05-18" & am_data$time_am == "6:35"), ]

#remove duplicates for 106 on 2021-05-20 
am_data <- am_data[!(am_data$ID == 106 & am_data$daterated == "2021-05-20" & am_data$time_am == "4:50"), ]

#remove duplicates for 106 on 2021-05-24 
am_data <- am_data[!(am_data$ID == 106 & am_data$daterated == "2021-05-24" & am_data$time_am == "21:59"), ]
am_data <- am_data[!(am_data$ID == 106 & am_data$daterated == "2021-05-24" & am_data$time_am == "22:00"), ]
am_data <- am_data[!(am_data$ID == 106 & am_data$daterated == "2021-05-24" & am_data$time_am == "22:02"), ]

#remove duplicates for 112 on 2021-06-28 
am_data <- am_data[!(am_data$ID == 112 & am_data$daterated == "2021-06-28" & am_data$time_am == "4:58"), ]

#remove duplicates for 112 on 2021-07-11
am_data <- am_data[!(am_data$ID == 112 & am_data$daterated == "2021-07-11" & am_data$time_am == "18:38"), ] 

#remove duplicates for 113 on 2021-06-23 
am_data <- am_data[!(am_data$ID == 113 & am_data$daterated == "2021-06-23" & am_data$time_am == "14:34"), ] 

#remove duplicates for 113 on 2021-07-07 
am_data <- am_data[!(am_data$ID == 113 & am_data$daterated == "2021-07-07" & am_data$time_am == "11:57"), ] 

#remove duplicates for 113 on 2021-07-21
am_data <- am_data[!(am_data$ID == 113 & am_data$daterated == "2021-07-21" & am_data$time_am == "11:12"), ] 

#remove duplicates for 114 on 2021-06-29
am_data <- am_data[!(am_data$ID == 114 & am_data$daterated == "2021-06-29" & am_data$time_am == "22:00"), ] 

#remove duplicates for 114 on 2021-07-01 
am_data <- am_data[!(am_data$ID == 114 & am_data$daterated == "2021-07-01 " & am_data$time_am == "9:33"), ] 

#remove duplicates for 114 on 2021-07-04 
am_data <- am_data[!(am_data$ID == 114 & am_data$daterated == "2021-07-04" & am_data$time_am == "5:58"), ] 

#remove duplicates for 114 on 2021-07-06
am_data <- am_data[!(am_data$ID == 114 & am_data$daterated == "2021-07-06" & am_data$time_am == "4:52"), ] 

#remove duplicates for 114 on 2021-07-09 
am_data <- am_data[!(am_data$ID == 114 & am_data$daterated == "2021-07-09" & am_data$time_am == "21:44"), ] 
am_data <- am_data[!(am_data$ID == 114 & am_data$daterated == "2021-07-09" & am_data$time_am == "21:45"), ] 

#remove duplicates for 114 on 2021-07-15
am_data <- am_data[!(am_data$ID == 114 & am_data$daterated == "2021-07-15" & am_data$time_am == "7:44"), ] 

#remove duplicates for 115 on 2021-06-24 
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-06-24" & am_data$time_am == "6:52"), ] 

#remove duplicates for 115 on 2021-06-27
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-06-27" & am_data$time_am == "8:27"), ] 

#remove duplicates for 115 on 2021-07-01
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-01" & am_data$time_am == "19:53"), ] 

#remove duplicates for 115 on 2021-07-04
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-04" & am_data$time_am == "3:00"), ] 
#remove duplicates for 115 on 2021-07-09 
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-09" & am_data$time_am == "21:49"), ] 
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-09" & am_data$time_am == "21:52"), ] 
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-09" & am_data$time_am == "21:55"), ] 
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-09" & am_data$time_am == "22:01"), ] 

#remove duplicates for 115 on 2021-07-11
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-11" & am_data$time_am == "8:38"), ] 
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-11" & am_data$time_am == "8:41"), ] 

#remove duplicates for 115 on 2021-07-20 
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-20" & am_data$time_am == "6:50"), ] 
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-20" & am_data$time_am == "6:57"), ] 
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-20" & am_data$time_am == "7:00"), ] 
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-20" & am_data$time_am == "7:04"), ] 
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-20" & am_data$time_am == "7:06"), ] 
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-20" & am_data$time_am == "7:09"), ] 
am_data <- am_data[!(am_data$ID == 115 & am_data$daterated == "2021-07-20" & am_data$time_am == "7:13"), ]

#remove duplicates for 118 on 2021-08-08
am_data <- am_data[!(am_data$ID == 118 & am_data$daterated == "2021-08-08" & am_data$time_am == "12:29"), ] 

#remove duplicates for 119 on 2021-08-27
am_data <- am_data[!(am_data$ID == 119 & am_data$daterated == "2021-08-27" & am_data$time_am == "21:42"), ] 

#remove duplicates for 123 on 2021-08-31
am_data <- am_data[!(am_data$ID == 123 & am_data$daterated == "2021-08-31" & am_data$time_am == "5:05"), ] 

#remove duplicates for 131 on 2021-10-17 
am_data <- am_data[!(am_data$ID == 131 & am_data$daterated == "2021-10-17" & am_data$time_am == "22:16"), ] 

#remove duplicates for ID 136 on 2021-11-29 
am_data <- am_data[!(am_data$ID == 136 & am_data$daterated == "2021-11-29" & am_data$time_am == "12:56"), ] 

#remove duplicates for ID 141 on 2022-02-01
am_data <- am_data[!(am_data$ID == 141 & am_data$daterated == "2022-02-01" & am_data$time_am == "7:30"), ] 
#remove duplicates for ID 149 on 2022-06-13
am_data <- am_data[!(am_data$ID == 149 & am_data$daterated == "2022-06-13" & am_data$time_am == "13:57"), ] 

#remove duplicates for ID 159 on 2022-07-17
am_data <- am_data[!(am_data$ID == 159 & am_data$daterated == "2022-07-17" & am_data$time_am == "9:59"), ] 

#remove duplicates for ID 159 on 2022-08-05
am_data <- am_data[!(am_data$ID == 159 & am_data$daterated == "2022-08-05" & am_data$time_am == "9:59"), ] 

#remove duplicates for ID 161 on 2022-08-12
am_data <- am_data[!(am_data$ID == 161 & am_data$daterated == "2022-08-12" & am_data$time_am == "6:30"), ] 

#remove duplicates for ID 166 on 2022-09-15
am_data <- am_data[!(am_data$ID == 166 & am_data$daterated == "2022-09-15" & am_data$time_am == "10:52"), ] 

#remove duplicates for 171 on 2022-10-21 
am_data <- am_data[!(am_data$ID == 171 & am_data$daterated == "2022-10-21" & am_data$time_am == "13:03"), ] 

#remove duplicates for 180 on 2023-03-26
am_data <- am_data[!(am_data$ID == 180 & am_data$daterated == "2023-03-26" & am_data$time_am == "2:42"), ] 

#remove duplicates for 181 on 2023-03-22
am_data <- am_data[!(am_data$ID == 181 & am_data$daterated == "2023-03-22" & am_data$time_am == "13:46"), ] 
```

#Remove pm_data rows so that we no longer have >1 submission per am or pm data per date. Kept earliest timestamp if all submissions are identical, or kept most complete form if some are more completed than others.
```{r}
#use this code to filter data pm_data %>%
  #filter(ID == x & daterated == ymd("x"))
#ID 106
pm_data <- pm_data[!(pm_data$ID == 106 & pm_data$daterated == "2021-05-08" & pm_data$time_pm == "10H 0M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 106 & pm_data$daterated == "2021-05-13" & pm_data$time_pm == "4H 57M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 106 & pm_data$daterated == "2021-05-19" & pm_data$time_pm == "4H 52M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 106 & pm_data$daterated == "2021-05-22" & pm_data$time_pm == "10H 32M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 106 & pm_data$daterated == "2021-05-23" & pm_data$time_pm == "13H 8M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 106 & pm_data$daterated == "2021-05-24" & pm_data$time_pm == "7H 18M 0S"), ]
#ID 107
pm_data <- pm_data[!(pm_data$ID == 107 & pm_data$daterated == "2021-05-29" & pm_data$time_pm == "7H 18M 0S"), ]

#ID 109 
pm_data <- pm_data[!(pm_data$ID == 109 & pm_data$daterated == "2021-06-22" & pm_data$time_pm == "20H 30M 0S"), ]

#ID 113 
pm_data <- pm_data[!(pm_data$ID == 113 & pm_data$daterated == "2021-06-29" & pm_data$time_pm == "21H 25M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 113 & pm_data$daterated == "2021-07-02" & pm_data$time_pm == "23H 03M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 113 & pm_data$daterated == "2021-07-05" & pm_data$time_pm == "0H 21M 0S"), ]
#ID 114
pm_data <- pm_data[!(pm_data$ID == 114 & pm_data$daterated == "2021-07-03" & pm_data$time_pm == "5H 57M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 114 & pm_data$daterated == "2021-07-05" & pm_data$time_pm == "4H 46M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 114 & pm_data$daterated == "2021-07-09" & pm_data$time_pm == "21H 43M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 114 & pm_data$daterated == "2021-07-09" & pm_data$time_pm == "21H 44M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 114 & pm_data$daterated == "2021-07-11" & pm_data$time_pm == "20H 46M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 114 & pm_data$daterated == "2021-07-14" & pm_data$time_pm == "7H 48M 0S"), ]
#ID 115 
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-06-26" & pm_data$time_pm == "8H 20M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-06-28" & pm_data$time_pm == "22H 1M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-01" & pm_data$time_pm == "19H 52M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-03" & pm_data$time_pm == "3H 5M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-09" & pm_data$time_pm == "21H 52M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-09" & pm_data$time_pm == "21H 54M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-09" & pm_data$time_pm == "21H 57M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-10" & pm_data$time_pm == "8H 37M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-10" & pm_data$time_pm == "8H 40M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-19" & pm_data$time_pm == "6H 48M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-19" & pm_data$time_pm == "6H 56M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-19" & pm_data$time_pm == "6H 59M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-19" & pm_data$time_pm == "7H 3M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-19" & pm_data$time_pm == "7H 6M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-19" & pm_data$time_pm == "7H 8M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-19" & pm_data$time_pm == "7H 10M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 115 & pm_data$daterated == "2021-07-19" & pm_data$time_pm == "7H 12M 0S"), ]

#ID 118 
pm_data <- pm_data[!(pm_data$ID == 118 & pm_data$daterated == "2021-08-08" & pm_data$time_pm == "12H 26M 0S"), ]
#ID 119 
pm_data <- pm_data[!(pm_data$ID == 119 & pm_data$daterated == "2021-08-03" & pm_data$time_pm == "21H 58M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 119 & pm_data$daterated == "2021-08-08" & pm_data$time_pm == "20H 50M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 119 & pm_data$daterated == "2021-08-13" & pm_data$time_pm == "5H 37M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 119 & pm_data$daterated == "2021-08-20" & pm_data$time_pm == "23H 28M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 119 & pm_data$daterated == "2021-08-22" & pm_data$time_pm == "5H 40M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 119 & pm_data$daterated == "2021-08-24" & pm_data$time_pm == "16H 23M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 119 & pm_data$daterated == "2021-08-27" & pm_data$time_pm == "21H 40M 0S"), ]
#ID 136
pm_data <- pm_data[!(pm_data$ID == 136 & pm_data$daterated == "2021-11-29" & pm_data$time_pm == "17H 10M 0S"), ]
#ID 138
pm_data <- pm_data[!(pm_data$ID == 138 & pm_data$daterated == "2022-02-06" & pm_data$time_pm == "12H 21M 0S"), ]
#ID 143
pm_data <- pm_data[!(pm_data$ID == 143 & pm_data$daterated == "2022-01-31" & pm_data$time_pm == "17H 04M 0S"), ]
#ID 149
pm_data <- pm_data[!(pm_data$ID == 149 & pm_data$daterated == "2022-05-25" & pm_data$time_pm == "0H 42M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 149 & pm_data$daterated == "2022-06-10" & pm_data$time_pm == "12H 20M 0S"), ]
#ID 150
pm_data <- pm_data[!(pm_data$ID == 150 & pm_data$daterated == "2022-06-07" & pm_data$time_pm == "21H 34M 0S"), ]
#ID 153
pm_data <- pm_data[!(pm_data$ID == 153 & pm_data$daterated == "2022-06-23" & pm_data$time_pm == "8H 24M 0S"), ]
#ID 159
pm_data <- pm_data[!(pm_data$ID == 159 & pm_data$daterated == "2022-07-17" & pm_data$time_pm == "6H 40M 0S"), ]
#ID 168
pm_data <- pm_data[!(pm_data$ID == 168 & pm_data$daterated == "2022-09-25" & pm_data$time_pm == "20H 23M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 168 & pm_data$daterated == "2022-10-09" & pm_data$time_pm == "18H 47M 0S"), ]
#ID 171
pm_data <- pm_data[!(pm_data$ID == 171 & pm_data$daterated == "2022-10-07" & pm_data$time_pm == "0H 10M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 171 & pm_data$daterated == "2022-10-13" & pm_data$time_pm == "12H 34M 0S"), ]
pm_data <- pm_data[!(pm_data$ID == 171 & pm_data$daterated == "2022-10-31" & pm_data$time_pm == "20H 36M 0S"), ]
#ID 180
pm_data <- pm_data[!(pm_data$ID == 180 & pm_data$daterated == "2023-04-15" & pm_data$time_pm == "22H 7M 0S"), ]
#ID 181
pm_data <- pm_data[!(pm_data$ID == 181 & pm_data$daterated == "2023-03-22" & pm_data$time_pm == "19H 13M 0S"), ]
#ID 185
pm_data <- pm_data[!(pm_data$ID == 185 & pm_data$daterated == "2023-05-29" & pm_data$time_pm == "23H 34M 0S"), ]
```

### create new column for presence or absence of drinking in am dataset 
```{r}
am_data <- am_data %>%
  mutate(drink_today_am = ifelse(Alc_Amt_am == 0, 0, 1)) 
```

### create new column for presence or absence of heavy drinking (> or eq to 4 in one day) in am dataset 
```{r}
am_data <- am_data %>%
  mutate(heavy_drink_am = ifelse(Alc_Amt_am >= 4, 1, 0))
```

### identify how many people drank alcohol throughout the study 
```{r}
summary_Alc_daily <- am_data %>% group_by(ID) %>% 
  summarize(drink_today_am = n(),
            TotalDrinkingDays = sum(drink_today_am, na.rm = TRUE),
            MinDrinksperDay = min(Alc_Amt_am, na.rm = TRUE),
            MaxDrinksperDay = max(Alc_Amt_am, na.rm = TRUE),
            MeanDrinksperDay = mean(Alc_Amt_am, na.rm = TRUE)) %>%
  arrange(drink_today_am)

summary_Alc_daily
##COUNTS
summary_Alc_daily %>% tally() #all 82 participants drank alcohol 
summary_Alc_daily %>% tally(TotalDrinkingDays ==0) #no participants drank no alcohol 

## number of ppl w at least one binge-drink day (>4 drinks on one day) = 51
am_data$Alc_Amt_am <- as.numeric(am_data$Alc_Amt_am)
am_data %>% group_by(ID) %>% 
  filter(Alc_Amt_am > 4) 
```

### create person means, person deviations and 3 day rolling avg for am_data
```{r echo=T}
#create person means

#step 1: make variables numeric that aren't already 
am_data$Alc_Drunk_am <- as.numeric(am_data$Alc_Drunk_am)
am_data$Crav_Alc_am <- as.numeric(am_data$Crav_Alc_am)
am_data$Crav_Nic_am <- as.numeric(am_data$Crav_Nic_am)
am_data$Crav_Mar_am <- as.numeric(am_data$Crav_Mar_am)
am_data$Crav_Coc_am <- as.numeric(am_data$Crav_Coc_am)
am_data$Crav_Benz_am <- as.numeric(am_data$Crav_Benz_am)
am_data$Crav_Hall_am <- as.numeric(am_data$Crav_Hall_am)
am_data$Crav_Opiate_am <- as.numeric(am_data$Crav_Opiate_am)
am_data$Crav_Opiate_am <- as.numeric(am_data$ID)

#Create person means   
am_data <- am_data %>% group_by(ID) %>% mutate(Urg_Alc_am.m = mean(Urg_Alc_am, na.rm = T),
                                              Urg_Nic_am.m = mean(Urg_Nic_am, na.rm = T),
                                               Urg_Mar_am.m = mean(Urg_Mar_am, na.rm = T),
                                               Urg_Coc_am.m = mean(Urg_Coc_am, na.rm = T),
                                               Urg_Oth_am.m = mean(Urg_Oth_am, na.rm = T),
                                               Crav_Alc_am.m = mean(Crav_Alc_am, na.rm = T),
                                               Crav_Nic_am.m = mean(Crav_Nic_am, na.rm = T),
                                               Crav_Mar_am.m = mean(Crav_Mar_am, na.rm = T),
                                               Crav_Coc_am.m = mean(Crav_Coc_am, na.rm = T),
                                               Crav_Benz_am.m = mean(Crav_Benz_am, na.rm = T),
                                               Crav_Hall_am.m = mean(Crav_Hall_am, na.rm = T),
                                               Crav_Opiate_am.m = mean(Crav_Opiate_am, na.rm = T),
                                               Alc_Amt_am.m = mean(Alc_Amt_am, na.rm = T),
                                              Alc_Drunk_am.m = mean(Alc_Drunk_am, na.rm = T))

#create person-centered deviations
am_data <- am_data %>% rowwise() %>% mutate(Urg_Alc_am.d = Urg_Alc_am - Urg_Alc_am.m, na.rm = T,
                                            Urg_Nic_am.d = Urg_Nic_am - Urg_Nic_am.m, na.rm = T,
                                            Urg_Mar_am.d = Urg_Mar_am - Urg_Mar_am.m, na.rm = T,
                                            Urg_Coc_am.d = Urg_Coc_am - Urg_Coc_am.m, na.rm = T,
                                            Urg_Oth_am.d = Urg_Oth_am - Urg_Oth_am.m, na.rm = T,
                                            Crav_Alc_am.d = Crav_Alc_am - Crav_Alc_am.m, na.rm = T,
                                            Crav_Mar_am.d = Crav_Mar_am - Crav_Mar_am.m, na.rm = T,
                                            Crav_Coc_am.d = Crav_Coc_am - Crav_Coc_am.m, na.rm = T,
                                            Crav_Benz_am.d = Crav_Benz_am - Crav_Benz_am.m, na.rm = T,
                                            Crav_Hall_am.d = Crav_Hall_am - Crav_Hall_am.m, na.rm = T,
                                            Crav_Opiate_am.d = Crav_Opiate_am - Crav_Opiate_am.m, na.rm = T,
                                            Alc_Amt_am.d = Alc_Amt_am - Alc_Amt_am.m, na.rm = T,
                                            Alc_Drunk_am.d = Alc_Drunk_am - Alc_Drunk_am.m, na.rm = T)


am_vars_roll_list <- c("Urg_Alc_am", "Urg_Nic_am", "Urg_Mar_am", "Urg_Coc_am", "Urg_Oth_am", "Crav_Alc_am", "Crav_Nic_am", "Crav_Mar_am", "Crav_Coc_am", "Crav_Benz_am", "Crav_Hall_am", "Crav_Opiate_am", "Alc_Amt_am", "Alc_Drunk_am") 


#Saving function 
create.3day.rolling.avg <- function(df, var) {
   df %>%
     group_by(ID) %>%     mutate("{{var}}.roll" := rollapply({{var}}, 3,  mean, align="center", fill=NA))
}

#Rolling averages
for (i in am_vars_roll_list) {
  am_data <- create.3day.rolling.avg(am_data, !!sym({{i}}))
}

#example for how to check that the roll function worked
am_data %>% select(Urg_Alc_am, Urg_Alc_am.roll, Urg_Nic_am, Urg_Nic_am.roll, Urg_Mar_am, Urg_Mar_am.roll) %>% View()
#how to run rolling.avg fx on just 1 var at a time
am_data <- create.3day.rolling.avg(am_data, Urg_Alc_am)

```

#raincloud plots on raw variables on interest from am_data
```{r}
#Alc amt - interesting
ggplot(am_data, aes(1, Alc_Amt_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank())   
#Feel Drunk - potentially interesting 
ggplot(am_data, aes(1, Alc_Drunk_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank())  
#Alc urge - not interesting
ggplot(am_data, aes(1, Urg_Alc_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Nic urge - not interesting
ggplot(am_data, aes(1, Urg_Nic_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Mar urge - not interesting
ggplot(am_data, aes(1, Urg_Mar_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Coc urge - not interesting 
ggplot(am_data, aes(1, Urg_Coc_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Oth urge - not interesting 
ggplot(am_data, aes(1, Urg_Oth_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Alc Crave - interesting 
ggplot(am_data, aes(1, Crav_Alc_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Mar Crave - interesting 
ggplot(am_data, aes(1, Crav_Mar_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Coc Crave - not interesting 
ggplot(am_data, aes(1, Crav_Coc_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Benz Crave - not interesting 
ggplot(am_data, aes(1, Crav_Benz_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Hall Crave - not interesting 
ggplot(am_data, aes(1, Crav_Hall_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Opiate Crav - not interesting 
ggplot(am_data, aes(1, Crav_Opiate_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
```
#New column for day of week
```{r}
am_data <- am_data %>%
  mutate(DayOfWeek = wday(daterated, label = TRUE, abbr = TRUE))
##mutate DayOfWeek column to be day - 1 because they fill out survey next morning 
am_data <- am_data %>%
  mutate(PreviousDayOfWeek = (DayOfWeek - 2) %% 7 + 1) ##didn't appear to work 
pm_data <- pm_data %>%
  mutate(DayOfWeek = wday(daterated, label = TRUE, abbr = TRUE))
```
#Create Binge Drink Column
```{r}
#create binary variable for binge drink (>=4 drinks per day) 
am_data <- am_data %>%
  mutate(BingeDrink_am = ifelse(Alc_Amt_am > 4, 1, 0)) 
```

#Day of the week analysis 
```{r}
#weekend defined as Saturday/Sunday (so indicates amount Fri/Sat bc amts are for the night before)
am_data_weekend <- am_data %>%
  filter(wday(daterated) %in% c(1, 7))
am_data_weekday <- am_data %>%
  filter(wday(daterated) %in% c(2, 3, 4, 5, 6))
#Alc Amt
ggplot(am_data_weekend, aes(1, Alc_Amt_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank())
ggplot(am_data_weekend, aes(1, Alc_Amt_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank())
Alc_Amt_am_model_weekend <- lmer(Alc_Amt_am~ (1 | ID),
                                 data = am_data_weekend)
summary(Alc_Amt_am_model_weekend)
icc(Alc_Amt_am_model_weekend) 
ggplot(am_data_weekday, aes(1, Alc_Amt_am)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank())
ggplot(am_data_weekday, aes(1, Alc_Amt_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank())
Alc_Amt_am_model_weekday <- lmer(Alc_Amt_am~ (1 | ID),
                                 data = am_data_weekday)
summary(Alc_Amt_am_model_weekday)
icc(Alc_Amt_am_model_weekday) 
##alc amt stats by day of week 
#Saturday (actually indicates Friday)
am_data_Sat <- am_data %>%
  filter(wday(daterated) %in% c(7))
summary(am_data_Sat$Alc_Amt_am, na.rm =T)
#Sunday (actually indicates Saturday)
am_data_Sun <- am_data %>%
  filter(wday(daterated) %in% c(1))
summary(am_data_Sun$Alc_Amt_am, na.rm =T)
#Monday (actually indicates Sunday)
am_data_Mon <- am_data %>%
  filter(wday(daterated) %in% c(2))
summary(am_data_Mon$Alc_Amt_am, na.rm =T)
#Tuesday (actually indicates Monday)
am_data_Tues <- am_data %>%
  filter(wday(daterated) %in% c(3))
summary(am_data_Tues$Alc_Amt_am, na.rm =T)
#Wednesday (actually indicates Tuesday)
am_data_Wed <- am_data %>%
  filter(wday(daterated) %in% c(4))
summary(am_data_Wed$Alc_Amt_am, na.rm =T)
#Thursday (actually indicates Wednesday)
am_data_Thurs <- am_data %>%
  filter(wday(daterated) %in% c(5))
summary(am_data_Thurs$Alc_Amt_am, na.rm =T)
#Friday (actually indicates Thursday)
am_data_Fri <- am_data %>%
  filter(wday(daterated) %in% c(6))
summary(am_data_Fri$Alc_Amt_am, na.rm =T) 
###Plots by Day of Week 
ggplot(am_data, aes(x = factor(DayOfWeek), y = Alc_Amt_am)) +
  geom_point(position = position_jitter(width = 0.1), size = 1) +
  labs(x = "Day of the Week", y = "Number of Drinks") +
  scale_x_discrete(labels = c("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"))
ggplot(am_data, aes(x = factor(DayOfWeek), y = Alc_Amt_am.d)) +
  geom_boxplot() +
  labs(x = "Day of the Week", y = "Number of Drinks") +
  scale_x_discrete(labels = c("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"))

```
#Binge drinks per day (subtract one day for each bc surveys are filled out next day)
```{r}
#number of people who binge drank on Sundays = 38
am_data_Sun %>% group_by(ID) %>% 
  filter(Alc_Amt_am > 4) 
#number of people who binge drank on Mondays = 9
am_data_Mon %>% group_by(ID) %>% 
  filter(Alc_Amt_am > 4) 
#number of people who binge drank on Tuesdays = 7
am_data_Tues %>% group_by(ID) %>% 
  filter(Alc_Amt_am > 4) 
#number of people who binge drank on Wednesdays = 5
am_data_Wed %>% group_by(ID) %>% 
  filter(Alc_Amt_am > 4) 
#number of people who binge drank on Thursdays = 5
am_data_Thurs %>% group_by(ID) %>% 
  filter(Alc_Amt_am > 4) 
#number of people who binge drank on Fridays = 13
am_data_Fri %>% group_by(ID) %>% 
  filter(Alc_Amt_am > 4) 
#number of people who binge drank on Saturdays = 28
am_data_Sat %>% group_by(ID) %>% 
  filter(Alc_Amt_am > 4) 
```

#raincloud plots on person-centered variables on interest from am_data
```{r}
#Alc amt - interesting
ggplot(am_data, aes(1, Alc_Amt_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank())
#Feel Drunk - interesting 
ggplot(am_data, aes(1, Alc_Drunk_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank())   
#Alc urge - interesting
ggplot(am_data, aes(1, Urg_Alc_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Nic urge - potentially interesting
ggplot(am_data, aes(1, Urg_Nic_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Mar urge - interesting
ggplot(am_data, aes(1, Urg_Mar_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Coc urge - not interesting 
ggplot(am_data, aes(1, Urg_Coc_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Oth urge - not interesting 
ggplot(am_data, aes(1, Urg_Oth_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Alc Crave - interesting 
#Would be interesting to compare difference between crav_alc and urg_alc? 
ggplot(am_data, aes(1, Crav_Alc_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Mar Crave - interesting 
ggplot(am_data, aes(1, Crav_Mar_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Coc Crave - not interesting 
ggplot(am_data, aes(1, Crav_Coc_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Benz Crave - not interesting 
ggplot(am_data, aes(1, Crav_Benz_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Hall Crave - not interesting 
ggplot(am_data, aes(1, Crav_Hall_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Opiate Crav - not interesting 
ggplot(am_data, aes(1, Crav_Opiate_am.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
```


## IF OUTCOME IS LINEAR, function is "lmer" not "glmer"
# rest of syntax is the same, including * for interaction and placement of random effect terms
model6 <- lmer(DMQsocial_today~legalage+age.z+covidrestrictions+
                                   currentdx_SUDalc+currentdx_SUDnonalc+frisatsun+
                                   LH_perimenstrual_count+LH_midluteal_count+LH_midfol_LH
                                 +(1+LH_midluteal_count+
                                     LH_midfol_LH+
                                     LH_perimenstrual_count | id), 
                                 control=lmerControl(optimizer="optimx",
                                                     optCtrl=list(method='nlminb')),
                                 data = etoh_data_motives)
#Create ICC for each variable that showed high variability on rainclouds from am_data 
```{r}
#calculate interclass correlations within person for each possible outcome (0 means all w/in person variance, 1 is between person variance) 
#Alc Urg ICC 0.266 
Urg_Alc_am_model <- lmer(Urg_Alc_am~ (1 | ID),
                                 data = am_data)
summary(Urg_Alc_am_model)
icc(Urg_Alc_am_model) 
#Alc Drunk ICC 0.742
Alc_Drunk_am_model <- lmer(Alc_Drunk_am~ (1 | ID),
                                 data = am_data)
summary(Alc_Drunk_am_model)
icc(Alc_Drunk_am_model) 
#Alc Crav ICC 0.617 
Crav_Alc_am_model <- lmer(Crav_Alc_am~ (1 | ID),
                                 data = am_data)
summary(Crav_Alc_am_model)
icc(Crav_Alc_am_model) 
#Alc Amt ICC 0.274
Alc_Amt_am_model <- lmer(Alc_Amt_am~ (1 | ID),
                                 data = am_data)
summary(Alc_Amt_am_model)
icc(Alc_Amt_am_model) 
#Mar crav ICC 0.741
Crav_Mar_am_model <- lmer(Crav_Mar_am~ (1 | ID),
                                 data = am_data)
summary(Crav_Mar_am_model)
icc(Crav_Mar_am_model) 

#Mar urg ICC 0.763
Urg_Mar_am_model <- lmer(Urg_Mar_am~ (1 | ID),
                                 data = am_data)
summary(Urg_Mar_am_model) 
icc(Urg_Mar_am_model) 
```

### pm data means, deviations, and rolling avg 
```{r}
#step 1: make variables numeric that aren't already 
pm_data$Diff_Inhib_pm <- as.numeric(gsub("\\D", "", pm_data$Diff_Inhib_pm))
pm_data$Diff_Change_pm <- as.numeric(gsub("\\D", "", pm_data$Diff_Change_pm))
pm_data$Diff_Stop_pm <- as.numeric(gsub("\\D", "", pm_data$Diff_Stop_pm))
pm_data$Immed_Payoff_pm <- as.numeric(gsub("\\D", "", pm_data$Immed_Payoff_pm))
pm_data$Res_Urge_pm <- as.numeric(gsub("\\D", "", pm_data$Res_Urge_pm))
pm_data$Diff_LongRew_pm <- as.numeric(gsub("\\D", "", pm_data$Diff_LongRew_pm))
pm_data$Diff_ResRew_pm <- as.numeric(gsub("\\D", "", pm_data$Diff_ResRew_pm))
pm_data$Dep_pm <- as.numeric(gsub("\\D", "", pm_data$Dep_pm))
pm_data$Hopeless_pm <- as.numeric(gsub("\\D", "", pm_data$Hopeless_pm))
pm_data$Worthless_pm <- as.numeric(gsub("\\D", "", pm_data$Worthless_pm))
pm_data$Anxious_pm <- as.numeric(gsub("\\D", "", pm_data$Anxious_pm))
pm_data$MoodSwing_pm <- as.numeric(gsub("\\D", "", pm_data$MoodSwing_pm))
pm_data$RejSens_pm <- as.numeric(gsub("\\D", "", pm_data$RejSens_pm))
pm_data$Angry_pm <- as.numeric(gsub("\\D", "", pm_data$Angry_pm))
pm_data$Conflicts_pm <- as.numeric(gsub("\\D", "", pm_data$Conflicts_pm))
pm_data$Loss_Interest_pm <- as.numeric(gsub("\\D", "", pm_data$Loss_Interest_pm))
pm_data$Diff_Conc_pm <- as.numeric(gsub("\\D", "", pm_data$Diff_Conc_pm))
pm_data$Tired_pm <- as.numeric(gsub("\\D", "", pm_data$Tired_pm))
pm_data$OverEat_pm <- as.numeric(gsub("\\D", "", pm_data$OverEat_pm))
pm_data$Sp_Food_Crav_pm <- as.numeric(gsub("\\D", "", pm_data$Sp_Food_Crav_pm))
pm_data$High_Sleep_pm <- as.numeric(gsub("\\D", "", pm_data$High_Sleep_pm))
pm_data$Diff_Sleep_pm <- as.numeric(gsub("\\D", "", pm_data$Diff_Sleep_pm))
pm_data$Overwhelm_pm <- as.numeric(gsub("\\D", "", pm_data$Overwhelm_pm))
pm_data$Loss_Control_pm <- as.numeric(gsub("\\D", "", pm_data$Loss_Control_pm))
pm_data$Breast_Tend_pm <- as.numeric(gsub("\\D", "", pm_data$Breast_Tend_pm))
pm_data$Breast_Swell_pm <- as.numeric(gsub("\\D", "", pm_data$Breast_Swell_pm))
pm_data$Headache_pm <- as.numeric(gsub("\\D", "", pm_data$Headache_pm))
pm_data$JM_Pain_pm <- as.numeric(gsub("\\D", "", pm_data$JM_Pain_pm))
pm_data$Loss_Prod_pm <- as.numeric(gsub("\\D", "", pm_data$Loss_Prod_pm))
pm_data$Int_Relat_pm <- as.numeric(gsub("\\D", "", pm_data$Int_Relat_pm))
pm_data$Urg_Alc_pm <- as.numeric(pm_data$Urg_Alc_pm)
pm_data$Urg_Nic_pm <- as.numeric(pm_data$Urg_Nic_pm)
pm_data$Urg_Mar_pm <- as.numeric(pm_data$Urg_Mar_pm)
pm_data$Urg_Coc_pm <- as.numeric(pm_data$Urg_Coc_pm)
#Create person means   
#make numerical if not already 

pm_data <- pm_data %>% group_by(ID) %>% mutate(Urg_Alc_pm.m = mean(Urg_Alc_pm, na.rm = T),
                                               Urg_Nic_pm.m = mean(Urg_Nic_pm, na.rm = T),
                                               Urg_Mar_pm.m = mean(Urg_Mar_pm, na.rm = T),
                                               Urg_Coc_pm.m = mean(Urg_Coc_pm, na.rm = T),
                                               Diff_Inhib_pm.m = mean(Diff_Inhib_pm, na.rm = T),
                                               Diff_Change_pm.m = mean(Diff_Change_pm, na.rm = T),
                                               Diff_Stop_pm.m = mean(Diff_Stop_pm, na.rm = T),
                                               Immed_Payoff_pm.m = mean(Immed_Payoff_pm, na.rm = T),
                                               Res_Urge_pm.m = mean(Res_Urge_pm, na.rm = T),
                                               Diff_LongRew_pm.m = mean(Diff_LongRew_pm, na.rm = T),
                                               Diff_ResRew_pm.m = mean(Diff_ResRew_pm, na.rm = T),
                                               Dep_pm.m = mean(Dep_pm, na.rm = T),
                                               Hopeless_pm.m = mean(Hopeless_pm, na.rm = T),
                                               Worthless_pm.m = mean(Worthless_pm, na.rm = T),
                                               Anxious_pm.m = mean(Anxious_pm, na.rm = T),
                                               MoodSwing_pm.m = mean(MoodSwing_pm, na.rm = T),
                                               RejSens_pm.m = mean(RejSens_pm, na.rm = T),
                                               Angry_pm.m = mean(Angry_pm, na.rm = T),
                                               Conflicts_pm.m = mean(Conflicts_pm, na.rm = T),
                                               Loss_Interest_pm.m = mean(Loss_Interest_pm, na.rm = T),
                                               Diff_Conc_pm.m = mean(Diff_Conc_pm, na.rm = T),
                                               Tired_pm.m = mean(Tired_pm, na.rm = T),
                                               OverEat_pm.m = mean(OverEat_pm, na.rm = T),
                                               Sp_Food_Crav_pm.m = mean(Sp_Food_Crav_pm, na.rm = T),
                                               High_Sleep_pm.m = mean(High_Sleep_pm, na.rm = T),
                                               Diff_Sleep_pm.m = mean(Diff_Sleep_pm, na.rm = T),
                                               Overwhelm_pm.m = mean(Overwhelm_pm, na.rm = T),
                                               Loss_Control_pm.m = mean(Loss_Control_pm, na.rm = T),
                                               Breast_Tend_pm.m = mean(Breast_Tend_pm, na.rm = T),
                                               Breast_Swell_pm.m = mean(Breast_Swell_pm, na.rm = T),
                                               Headache_pm.m = mean(Headache_pm, na.rm = T),
                                               JM_Pain_pm.m = mean(JM_Pain_pm, na.rm = T),
                                               Loss_Prod_pm.m = mean(Loss_Prod_pm, na.rm = T),
                                               Int_Relat_pm.m = mean(Int_Relat_pm, na.rm = T),
                                               Urg_Alc_pm.m = mean(Urg_Alc_pm, na.rm = T),
                                               Urg_Nic_pm.m = mean(Urg_Nic_pm, na.rm = T),
                                               Urg_Mar_pm.m = mean(Urg_Mar_pm, na.rm = T),
                                               Urg_Coc_pm.m = mean(Urg_Coc_pm, na.rm = T))
#create person-centered deviations 
pm_data <- pm_data %>% rowwise() %>% mutate(Urg_Alc_pm.d = Urg_Alc_pm - Urg_Alc_pm.m, na.rm = T, 
                                            Urg_Nic_pm.d = Urg_Nic_pm - Urg_Nic_pm.m, na.rm = T,
                                            Urg_Mar_pm.d = Urg_Mar_pm - Urg_Mar_pm.m, na.rm = T,
                                            Urg_Coc_pm.d = Urg_Coc_pm - Urg_Coc_pm.m, na.rm = T,
                                            Diff_Inhib_pm.d = Diff_Inhib_pm - Diff_Inhib_pm.m, na.rm = T,
                                            Diff_Change_pm.d = Diff_Change_pm - Diff_Change_pm.m, na.rm = T,
                                            Diff_Stop_pm.d = Diff_Stop_pm - Diff_Stop_pm.m, na.rm = T,
                                            Immed_Payoff_pm.d = Immed_Payoff_pm - Immed_Payoff_pm.m, na.rm = T,
                                            Res_Urge_pm.d = Res_Urge_pm - Res_Urge_pm.m, na.rm = T,
                                            Diff_LongRew_pm.d = Diff_LongRew_pm - Diff_LongRew_pm.m, na.rm = T, 
                                            Diff_ResRew_pm.d = Diff_ResRew_pm - Diff_ResRew_pm.m, na.rm = T,
                                            Dep_pm.d = Dep_pm - Dep_pm.m, na.rm = T, 
                                            Hopeless_pm.d = Hopeless_pm - Hopeless_pm.m, na.rm = T,
                                            Worthless_pm.d = Worthless_pm - Worthless_pm.m, na.rm = T,
                                            Anxious_pm.d = Anxious_pm - Anxious_pm.m, na.rm = T,
                                            MoodSwing_pm.d = MoodSwing_pm - MoodSwing_pm.m, na.rm = T,
                                            RejSens_pm.d = RejSens_pm - RejSens_pm.m, na.rm = T,
                                            Angry_pm.d = Angry_pm - Angry_pm.m, na.rm = T,
                                            Conflicts_pm.d = Conflicts_pm - Conflicts_pm.m, na.rm = T,
                                            Loss_Interest_pm.d = Loss_Interest_pm - Loss_Interest_pm.m, na.rm = T,
                                            Diff_Conc_pm.d = Diff_Conc_pm - Diff_Conc_pm.m, na.rm = T,
                                            Tired_pm.d = Tired_pm - Tired_pm.m, na.rm = T,
                                            OverEat_pm.d = OverEat_pm - OverEat_pm.m, na.rm = T,
                                            Sp_Food_Crav_pm.d = Sp_Food_Crav_pm - Sp_Food_Crav_pm.m, na.rm = T,
                                            High_Sleep_pm.d = High_Sleep_pm - High_Sleep_pm.m, na.rm = T,
                                            Diff_Sleep_pm.d = Diff_Sleep_pm - Diff_Sleep_pm.m, na.rm = T,
                                            Overwhelm_pm.d = Overwhelm_pm - Overwhelm_pm.m, na.rm = T,
                                            Loss_Control_pm.d = Loss_Control_pm - Loss_Control_pm.m, na.rm = T,
                                            Breast_Tend_pm.d = Breast_Tend_pm - Breast_Tend_pm.m, na.rm = T,
                                            Breast_Swell_pm.d = Breast_Swell_pm - Breast_Swell_pm.m, na.rm = T,
                                            Headache_pm.d = Headache_pm - Headache_pm.m, na.rm = T, 
                                            JM_Pain_pm.d = JM_Pain_pm - JM_Pain_pm.m, na.rm = T, 
                                            Loss_Prod_pm.d = Loss_Prod_pm - Loss_Prod_pm.m, na.rm = T,
                                            Int_Relat_pm.d = Int_Relat_pm - Int_Relat_pm.m, na.rm = T) 

pm_vars_roll_list <- c("Urg_Alc_pm", "Urg_Nic_pm", "Urg_Mar_pm", "Urg_Coc_pm", "Diff_Inhib_pm", "Diff_Change_pm", "Diff_Stop_pm", "Immed_Payoff_pm", "Res_Urge_pm", "Diff_LongRew_pm", "Diff_ResRew_pm", "Dep_pm", "Hopeless_pm", "Worthless_pm", "Anxious_pm", "MoodSwing_pm", "RejSens_pm", "RejSens_pm", "Angry_pm", "Conflicts_pm", "Loss_Interest_pm", "Diff_Conc_pm", "Tired_pm", "OverEat_pm", "Sp_Food_Crav_pm", "High_Sleep_pm", "Diff_Sleep_pm", "Overwhelm_pm", "Loss_Control_pm", "Breast_Tend_pm", "Breast_Swell_pm", "Headache_pm", "JM_Pain_pm", "Loss_Prod_pm", "Int_Relat_pm") 


#Saving function 
create.3day.rolling.avg <- function(df, var) {
   df %>%
     group_by(ID) %>%     mutate("{{var}}.roll" := rollapply({{var}}, 3,  mean, align="center", fill=NA))
}

#Rolling averages
for (i in pm_vars_roll_list) {
  pm_data <- create.3day.rolling.avg(pm_data, !!sym({{i}}))
}
```

#PM Data by Day of Week 
```{r}
#Saturday (actually indicates Friday)
pm_data_Sat <- pm_data %>%
  filter(wday(daterated) %in% c(7))
summary(pm_data_Sat$Urg_Alc_pm, na.rm =T) #alc urge mean = 2.4 on Fridays 
summary(pm_data_Sat$Urg_Alc_pm.d, na.rm =T) #person-centered alc urge mean = 0.34 on Fridays 
summary(pm_data_Sat$Diff_Inhib_pm, na.rm =T) #diff inhib mean = 1.2 on Fridays 
#Sunday (actually indicates Saturday)
pm_data_Sun <- pm_data %>%
  filter(wday(daterated) %in% c(1))
summary(pm_data_Sun$Urg_Alc_pm, na.rm =T) #alc urge mean = 1.85 on Saturdays 
summary(pm_data_Sun$Urg_Alc_pm.d, na.rm =T) #person-centered alc urge mean = -0.067 on Saturdays
summary(pm_data_Sun$Diff_Inhib_pm, na.rm =T) #diff inhib mean = 1.1 on Saturdays
#Monday (actually indicates Sunday)
pm_data_Mon <- pm_data %>%
  filter(wday(daterated) %in% c(2))
summary(pm_data_Mon$Urg_Alc_pm, na.rm =T) #alc urge mean = 1.75 on Sundays
summary(pm_data_Mon$Urg_Alc_pm.d, na.rm =T) #person-centered alc urge mean = -0.21 on Sundays
summary(pm_data_Mon$Diff_Inhib_pm, na.rm =T) #diff inhib mean = 1.2 on Sundays 
#Tuesday (actually indicates Monday)
pm_data_Tues <- pm_data %>%
  filter(wday(daterated) %in% c(3))
summary(pm_data_Tues$Urg_Alc_pm, na.rm =T) #alc urge mean = 1.99 on Mondays
summary(pm_data_Tues$Urg_Alc_pm.d, na.rm =T) #person-centered alc urge mean = -0.24 on Mondays
summary(pm_data_Tues$Diff_Inhib_pm, na.rm =T) #diff inhib mean = 1.1 on Mondays
#Wednesday (actually indicates Tuesday)
pm_data_Wed <- pm_data %>%
  filter(wday(daterated) %in% c(4))
summary(pm_data_Wed$Urg_Alc_pm, na.rm =T) #alc urge mean = 1.93 on Tuesdays 
summary(pm_data_Wed$Urg_Alc_pm.d, na.rm =T) #person-centered alc urge mean = -0.15 on Mondays
summary(pm_data_Wed$Diff_Inhib_pm, na.rm =T) #diff inhib mean = 1.1 on Tuesdays 
#Thursday (actually indicates Wednesday)
pm_data_Thurs <- pm_data %>%
  filter(wday(daterated) %in% c(5))
summary(pm_data_Thurs$Urg_Alc_pm, na.rm =T) #alc urge mean = 2.5 on Wednesdays 
summary(pm_data_Thurs$Urg_Alc_pm.d, na.rm =T) #person-centered alc urge mean = 0.24 on Mondays
summary(pm_data_Thurs$Diff_Inhib_pm, na.rm =T) #diff inhib mean = 1.1 on Tuesdays 
#Friday (actually indicates Thursday)
pm_data_Fri <- pm_data %>%
  filter(wday(daterated) %in% c(6))
summary(pm_data_Fri$Urg_Alc_pm, na.rm =T) #alc urge mean = 2.25 on Thursdays
summary(pm_data_Fri$Urg_Alc_pm.d, na.rm =T) #person-centered alc urge mean = 0.035 on Thursdays 
summary(pm_data_Fri$Diff_Inhib_pm, na.rm =T) #diff inhib mean = 1.2 on Thursdays  
###Plots by Day of Week 
ggplot(pm_data, aes(x = factor(DayOfWeek), y = Urg_Alc_pm)) +
  geom_point(position = position_jitter(width = 0.1), size = 1) +
  labs(x = "Day of the Week", y = "Urge to Drink") +
  scale_x_discrete(labels = c("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"))
ggplot(pm_data, aes(x = factor(DayOfWeek), y = Urg_Alc_pm.d)) +
  geom_boxplot() +
  labs(x = "Day of the Week", y = "Urge to Drink") +
  scale_x_discrete(labels = c("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"))
ggplot(pm_data, aes(x = factor(DayOfWeek), y = Diff_Inhib_pm.d)) +
  geom_boxplot() +
  labs(x = "Day of the Week", y = "Difficulty with Inhibition") +
  scale_x_discrete(labels = c("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"))
ggplot(pm_data, aes(x = factor(DayOfWeek), y = Diff_Stop_pm.d)) +
  geom_boxplot() +
  labs(x = "Day of the Week", y = "Difficulty with Stopping") +
  scale_x_discrete(labels = c("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"))
ggplot(pm_data, aes(x = factor(DayOfWeek), y = Res_Urge_pm.d)) +
  geom_boxplot() +
  labs(x = "Day of the Week", y = "Difficulty with Resisting Fun Urge") +
  scale_x_discrete(labels = c("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"))
ggplot(pm_data, aes(x = factor(DayOfWeek), y = Diff_ResRew_pm.d)) +
  geom_boxplot() +
  labs(x = "Day of the Week", y = "Difficulty with Immediate Reward") +
  scale_x_discrete(labels = c("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"))
```


ICCs for pm_data
```{r}
#Alc urge ICC 0.442 
Urg_Alc_pm_model <- lmer(Urg_Alc_pm~ (1 | ID),
                                 data = pm_data)
summary(Urg_Alc_pm_model)
icc(Urg_Alc_pm_model) 
#Nic urge ICC 0.770 
Urg_Nic_pm_model <- lmer(Urg_Nic_pm~ (1 | ID),
                                 data = pm_data)
summary(Urg_Nic_pm_model)
icc(Urg_Nic_pm_model) 
#Mar urge ICC 0.657
Urg_Mar_pm_model <- lmer(Urg_Mar_pm~ (1 | ID),
                                 data = pm_data)
summary(Urg_Mar_pm_model)
icc(Urg_Mar_pm_model) 
#Coc urge ICC 0.979 
Urg_Coc_pm_model <- lmer(Urg_Coc_pm~ (1 | ID),
                                 data = pm_data)
summary(Urg_Coc_pm_model)
icc(Urg_Coc_pm_model) 
#Diff inhib ICC 0.183 
Diff_Inhib_pm_model <- lmer(Diff_Inhib_pm~ (1 | ID),
                                 data = pm_data)
summary(Diff_Inhib_pm_model)
icc(Diff_Inhib_pm_model) 
#Diff change ICC 0.300
Diff_Change_pm_model <- lmer(Diff_Change_pm~ (1 | ID),
                                 data = pm_data)
summary(Diff_Change_pm_model)
icc(Diff_Change_pm_model) 
#Diff stop ICC 0.135
Diff_Stop_pm_model <- lmer(Diff_Stop_pm~ (1 | ID),
                                 data = pm_data)
summary(Diff_Stop_pm_model)
icc(Diff_Stop_pm_model) 
#Immed payoff ICC 0.271
Immed_Payoff_pm_model <- lmer(Immed_Payoff_pm~ (1 | ID),
                                 data = pm_data)
summary(Immed_Payoff_pm_model)
icc(Immed_Payoff_pm_model) 
#Res urge ICC 0.425
Res_Urge_pm_model <- lmer(Res_Urge_pm~ (1 | ID),
                                 data = pm_data)
summary(Res_Urge_pm_model)
icc(Res_Urge_pm_model) 
#Diff LongRew ICC 0.294 
Diff_LongRew_pm_model <- lmer(Diff_LongRew_pm~ (1 | ID),
                                 data = pm_data)
summary(Diff_LongRew_pm_model)
icc(Diff_LongRew_pm_model) 
#Diff ResRew ICC 0.278
Diff_ResRew_pm_model <- lmer(Diff_ResRew_pm~ (1 | ID),
                                 data = pm_data)
summary(Diff_ResRew_pm_model)
icc(Diff_ResRew_pm_model) 
#Depression ICC 0.221
Dep_pm_model <- lmer(Dep_pm~ (1 | ID),
                                 data = pm_data)
summary(Dep_pm_model)
icc(Dep_pm_model) 
#Hopeless ICC 0.174
Hopeless_pm_model <- lmer(Hopeless_pm~ (1 | ID),
                                 data = pm_data)
summary(Hopeless_pm_model)
icc(Hopeless_pm_model) 
#Worthless icc 0.280 
Worthless_pm_model <- lmer(Worthless_pm~ (1 | ID),
                                 data = pm_data)
summary(Worthless_pm_model)
icc(Worthless_pm_model) 
#Anxious icc 0.511 
Anxious_pm_model <- lmer(Anxious_pm~ (1 | ID),
                                 data = pm_data)
summary(Anxious_pm_model)
icc(Anxious_pm_model) 
#Moodswing icc 0.154
MoodSwing_pm_model <- lmer(MoodSwing_pm~ (1 | ID),
                                 data = pm_data)
summary(MoodSwing_pm_model)
icc(MoodSwing_pm_model) 
#RejSens icc 0.230 
RejSens_pm_model <- lmer(RejSens_pm~ (1 | ID),
                                 data = pm_data)
summary(RejSens_pm_model)
icc(RejSens_pm_model) 
#Angry icc 0.230 
Angry_pm_model <- lmer(Angry_pm~ (1 | ID),
                                 data = pm_data)
summary(Angry_pm_model)
icc(Angry_pm_model) 
#Conflicts icc 0.120
Conflicts_pm_model <- lmer(Conflicts_pm~ (1 | ID),
                                 data = pm_data)
summary(Conflicts_pm_model)
icc(Conflicts_pm_model) 
#Loss interest 0.259 
Loss_Interest_pm_model <- lmer(Loss_Interest_pm~ (1 | ID),
                                 data = pm_data)
summary(Loss_Interest_pm_model)
icc(Loss_Interest_pm_model) 
#Diff Conc icc 0.237 
Diff_Conc_pm_model <- lmer(Diff_Conc_pm~ (1 | ID),
                                 data = pm_data)
summary(Diff_Conc_pm_model)
icc(Diff_Conc_pm_model) 
#Tired icc 0.370
Tired_pm_model <- lmer(Tired_pm~ (1 | ID),
                                 data = pm_data)
summary(Tired_pm_model)
icc(Tired_pm_model)
#overeat icc 0.205 
OverEat_pm_model <- lmer(OverEat_pm~ (1 | ID),
                                 data = pm_data)
summary(OverEat_pm_model)
icc(OverEat_pm_model)
#spec food craving 0.147 
Sp_Food_Crav_pm_model <- lmer(Sp_Food_Crav_pm~ (1 | ID),
                                 data = pm_data)
summary(Sp_Food_Crav_pm_model)
icc(Sp_Food_Crav_pm_model)
#high sleep icc 0.195 
High_Sleep_pm_model <- lmer(High_Sleep_pm~ (1 | ID),
                                 data = pm_data)
summary(High_Sleep_pm_model)
icc(High_Sleep_pm_model)
#Overwhelm icc 0.211
Overwhelm_pm_model <- lmer(Overwhelm_pm~ (1 | ID),
                                 data = pm_data)
summary(Overwhelm_pm_model)
icc(Overwhelm_pm_model)
#Loss control icc 0.259 
Loss_Control_pm_model <- lmer(Loss_Control_pm~ (1 | ID),
                                 data = pm_data)
summary(Loss_Control_pm_model)
icc(Loss_Control_pm_model)
#Breast tend icc 0.161 
Breast_Tend_pm_model <- lmer(Breast_Tend_pm~ (1 | ID),
                                 data = pm_data)
summary(Breast_Tend_pm_model)
icc(Breast_Tend_pm_model)
#Breast swell icc 0.253 
Breast_Swell_pm_model <- lmer(Breast_Swell_pm~ (1 | ID),
                                 data = pm_data)
summary(Breast_Swell_pm_model)
icc(Breast_Swell_pm_model)
#Headache icc 0.274
Headache_pm_model <- lmer(Headache_pm~ (1 | ID),
                                 data = pm_data)
summary(Headache_pm_model)
icc(Headache_pm_model)
#JM Pain icc 0.222
JM_Pain_pm_model <- lmer(JM_Pain_pm~ (1 | ID),
                                 data = pm_data)
summary(JM_Pain_pm_model)
icc(JM_Pain_pm_model)
#Loss Prod icc 0.236 
Loss_Prod_pm_model <- lmer(Loss_Prod_pm~ (1 | ID),
                                 data = pm_data)
summary(Loss_Prod_pm_model)
icc(Loss_Prod_pm_model)
#Int relat icc 0.111
Int_Relat_pm_model <- lmer(Int_Relat_pm~ (1 | ID),
                                 data = pm_data)
summary(Int_Relat_pm_model)
icc(Int_Relat_pm_model)
```

#Raincloud plots on raw pm_data
```{r}
#Urg alc - interesting 
ggplot(pm_data, aes(1, Urg_Alc_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Urg nic - not interesting 
ggplot(pm_data, aes(1, Urg_Nic_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Urg mar - interesting 
ggplot(pm_data, aes(1, Urg_Mar_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Urg coc - not interesting 
ggplot(pm_data, aes(1, Urg_Coc_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Diff inhib - not interesting 
ggplot(pm_data, aes(1, Diff_Inhib_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Diff stop - not interesting 
ggplot(pm_data, aes(1, Diff_Stop_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Diff change - not interesting 
ggplot(pm_data, aes(1, Diff_Change_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Immed Payoff - kinda interesting 
ggplot(pm_data, aes(1, Immed_Payoff_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Res urge - kinda interesting 
ggplot(pm_data, aes(1, Res_Urge_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Diff longrew - not interesting 
ggplot(pm_data, aes(1, Diff_LongRew_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Diff resrew - not interesting 
ggplot(pm_data, aes(1, Diff_ResRew_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Dep - not interesting 
ggplot(pm_data, aes(1, Dep_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Hopeless - not interesting 
ggplot(pm_data, aes(1, Hopeless_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Worthless - not interesting 
ggplot(pm_data, aes(1, Worthless_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#MoodSwing - not interesting 
ggplot(pm_data, aes(1, MoodSwing_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#RejSens - not interesting 
ggplot(pm_data, aes(1, RejSens_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Angry - not interesting 
ggplot(pm_data, aes(1, Angry_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#LossInt - not interesting 
ggplot(pm_data, aes(1, Loss_Interest_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#DiffConc - not interesting 
ggplot(pm_data, aes(1, Diff_Conc_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Tired  - interesting ! 
ggplot(pm_data, aes(1, Tired_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Overeat  - not interesting 
ggplot(pm_data, aes(1, OverEat_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Spec Food Crav
ggplot(pm_data, aes(1, Sp_Food_Crav_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Angry - interesting 
ggplot(pm_data, aes(1, Angry_pm)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
```

#Raincloud plots for person-centered deviations 
```{r}
#Urg alc - interesting 
ggplot(pm_data, aes(1, Urg_Alc_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#OverEat - interesting 
ggplot(pm_data, aes(1, OverEat_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Diff Inhib - not interesting 
ggplot(pm_data, aes(1, Diff_Inhib_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Diff Change - not interesting 
ggplot(pm_data, aes(1, Diff_Change_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Diff Stop - not interesting 
ggplot(pm_data, aes(1, Diff_Stop_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Immed Payoff - interesting 
ggplot(pm_data, aes(1, Immed_Payoff_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Res Urge - not super interesting 
ggplot(pm_data, aes(1, Res_Urge_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Diff LongRew - not interesting 
ggplot(pm_data, aes(1, Diff_LongRew_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Depression - interesting 
ggplot(pm_data, aes(1, Dep_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Hopeless - not interesting 
ggplot(pm_data, aes(1, Hopeless_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Worthless - not interesting 
ggplot(pm_data, aes(1, Worthless_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#MoodSwing - interesting 
ggplot(pm_data, aes(1, MoodSwing_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#RejSens - not interesting 
ggplot(pm_data, aes(1, RejSens_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Angry - interesting 
ggplot(pm_data, aes(1, Angry_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Loss intereset - not interesting 
ggplot(pm_data, aes(1, Loss_Interest_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Diff conc
ggplot(pm_data, aes(1, Diff_Conc_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Diff conc - interesting 
ggplot(pm_data, aes(1, Tired_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Over-eating - interesting 
ggplot(pm_data, aes(1, OverEat_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Spec food craving - interesting 
ggplot(pm_data, aes(1, Sp_Food_Crav_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Overwhelm - not interesting 
ggplot(pm_data, aes(1, Overwhelm_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Loss control - not interesting 
ggplot(pm_data, aes(1, Loss_Control_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Breast tend - not interesting 
ggplot(pm_data, aes(1, Breast_Tend_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Breast swell - not interesting 
ggplot(pm_data, aes(1, Breast_Swell_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Headache - not interesting 
ggplot(pm_data, aes(1, Headache_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#JM Pain - not interesting 
ggplot(pm_data, aes(1, JM_Pain_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Loss prod - not interesting 
ggplot(pm_data, aes(1, Loss_Prod_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Interpersonal Relat- not interesting 
ggplot(pm_data, aes(1, Int_Relat_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
#Urg alc - interesting 
ggplot(pm_data, aes(1, Urg_Mar_pm.d)) +
  geom_rain() +
  theme_classic() +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(), axis.ticks.x = element_blank()) 
```


#Save cleaned files as csv files
```{r}
write.csv(am_data, "~/Library/CloudStorage/Box-Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/UKALC/02_datasets/UKALC_DAILY/03_cleaned_data/am_data_cleaned_JB.csv", row.names=TRUE)

write.csv(pm_data, "/Users/apatte21/Library/CloudStorage/Box-Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/UKALC/02_datasets/UKALC_DAILY/03_cleaned_data/pm_data_cleaned.csv", row.names=TRUE)
```



#Add in cycle day 
```{r}

cycle.day <- read.csv("~/Library/CloudStorage/Box-Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/UKALC/02_datasets/UKALC_DAILY/02_data_prep_workspace/UKAlc.Cycle.Day.csv")

```

#Merge in cycle day data 
```{r}
#use janitor package to make sure the 2 datasets can be merged
#return=mismatch will return only columns that cannot merge

cycle.day$daterated <- mdy(cycle.day$daterated)

cycleday.am.merge <- merge(cycle.day, am_data, by = c("ID", "daterated"), all = T)
cycleday.pm.merge <- merge(cycle.day, pm_data, by = c("ID", "daterated"), all = T)
```
#Add in LH Data
```{r}
LH.Count <- read.csv("~/Library/CloudStorage/Box-Box/00 - CLEAR Lab (Locked Folders)/02 - Data Management, Analysis, and Papers/Studies_Projects/UKALC/02_datasets/UKALC_DAILY/02_data_prep_workspace/UKAlc.LH.Data.csv")

LH.Count$daterated <- mdy(LH.Count$daterated)

cycleday.am.merge <- merge(LH.Count, cycleday.am.merge, by = c("ID", "daterated"), all = T)
cycleday.pm.merge <- merge(LH.Count, cycleday.pm.merge, by = c("ID", "daterated"), all = T)

write_csv(cycleday.am.merge, "Cycle_Day_LH_menses_am.csv")
write_csv(cycleday.pm.merge, "Cycle_Day_LH_menses_pm.csv")
```


```{r cyclephase_count}

cycleday.am.merge <- cycleday.am.merge %>% 
  mutate(midluteal_count = ifelse(cycleday >= -9 & cycleday <= -5, 1, 0),
         perimenstrual_count = ifelse(cycleday >=-3 & cycleday <=2, 1, 0),
         midfol_count = ifelse(cycleday >=4 & cycleday <=7, 1, 0),
         periov_count = ifelse(cycleday >= -15 & cycleday <= -12, 1, 0))

#add a non-dummy coded variable with all of cycle phase info above, which will be useful for future visualizations and summaries
cycleday.am.merge <- cycleday.am.merge %>% mutate(cyclephase_count = case_when(periov_count==1 ~ 1,
                                                     midluteal_count==1 ~ 2,
                                                     perimenstrual_count==1 ~ 3,
                                                     midfol_count==1 ~ 4,
                                                     TRUE ~ as.numeric(NA)))

cycleday.pm.merge <- cycleday.pm.merge %>% 
  mutate(midluteal_count = ifelse(cycleday >= -9 & cycleday <= -5, 1, 0),
         perimenstrual_count = ifelse(cycleday >=-3 & cycleday <=2, 1, 0),
         midfol_count = ifelse(cycleday >=4 & cycleday <=7, 1, 0),
         periov_count = ifelse(cycleday >= -15 & cycleday <= -12, 1, 0))

#add a non-dummy coded variable with all of cycle phase info above, which will be useful for future visualizations and summaries
cycleday.pm.merge <- cycleday.pm.merge %>% mutate(cyclephase_count = case_when(periov_count==1 ~ 1,
                                                     midluteal_count==1 ~ 2,
                                                     perimenstrual_count==1 ~ 3,
                                                     midfol_count==1 ~ 4,
                                                     TRUE ~ as.numeric(NA)))



```
#This LH cyclephase code is adapted from github repository: code_templates/prep_Cycle Phase Coding 5 phase - ADHD-KY.Rmd starting at step 5a 
```{r cyclephase_LH}

cycleday.am.merge <- cycleday.am.merge %>% 
  mutate(midluteal_LH = ifelse(daycountLH >= 6 & daycountLH <= 10, 1, 0),
         perimenstrual_LH = ifelse(cycleday >=-3 & cycleday <=2, 1, 0), #note perimenstrual is based on cycleday
         midfol_LH = ifelse(daycountLH >=-7 & daycountLH <=-3, 1, 0),
         periov_LH = ifelse(daycountLH >= -2 & daycountLH <= 1, 1, 0),
         earlylut_LH = ifelse(daycountLH >= 2 & daycountLH <= 5, 1, 0))

#fill out the dummy code, so that if any phase is 1, all others should be 0 (not NA)
cycleday.am.merge <- cycleday.am.merge %>%
  rowwise() %>%
  mutate(sumdummy = sum(midfol_LH,
                        periov_LH,
                        earlylut_LH,
                        perimenstrual_LH,
                        midluteal_LH, na.rm = T)) %>% 
  #if all phases=0, make the midluteal_LH variable NA instead of 0,
  #if perimenstrual by menses count = 1, change midluteal_LH to 0 instead of NA to fill out structural set,
  #otherwise, keep as is
  mutate(midluteal_LH = case_when(sumdummy==0 ~ as.numeric(NA),
                                  sumdummy==1 & perimenstrual_LH==1 ~ 0,
                                  TRUE ~ midluteal_LH), 
         #same for midfol
         midfol_LH = case_when(sumdummy==0 ~ as.numeric(NA),
                               sumdummy==1 & perimenstrual_LH==1 ~ 0,
                               TRUE ~ midfol_LH), 
          #same for periov
         periov_LH = case_when(sumdummy==0 ~ as.numeric(NA),
                               sumdummy==1 & perimenstrual_LH==1 ~ 0,
                               TRUE ~ periov_LH),
         earlylut_LH = case_when(sumdummy==0 ~ as.numeric(NA),
                                  sumdummy==1 & perimenstrual_LH==1 ~ 0,
                                  TRUE ~ earlylut_LH), 
         #if any other phase is 1, fill out perimenstrual to be 0
         perimenstrual_LH = case_when(sumdummy==0 ~ as.numeric(NA), 
                                        sumdummy==1 & midfol_LH==1 ~ 0,
                                        sumdummy==1 & periov_LH==1 ~ 0,
                                      sumdummy==1 & earlylut_LH==1 ~ 0,
                                        sumdummy==1 & midluteal_LH==1 ~ 0,
                                        TRUE ~ perimenstrual_LH))

#add a non-dummy coded variable with all of cycle phase info above, which will be useful for future visualizations and summaries
cycleday.am.merge <- cycleday.am.merge %>% mutate(cyclephase_LH = case_when(periov_LH==1 ~ 1,
                                                                        earlylut_LH==1 ~ 2,
                                                     midluteal_LH==1 ~ 3,
                                                     perimenstrual_LH==1 ~ 4,
                                                     midfol_LH==1 ~ 5,
                                                     TRUE ~ as.numeric(NA)))

#add names for easier visualization
cycleday.am.merge <- cycleday.am.merge %>% mutate(cyclephase_LHnames = factor(cyclephase_LH, 
                                                                              levels = c(1,2,3,4,5),
                                                                              labels = c("periov",
                                                                                         "earlylut",
                                                                                         "midlut",
                                                                                         "perimens",
                                                                                         "midfol")))

```

```{r}

#check overlaps: goal is to only have 6 possible group combinations here (1 row per dummy coded phase, then a row where ALL are NA)
cycleday.am.merge %>%
  group_by(periov_LH, earlylut_LH, midluteal_LH, perimenstrual_LH, midfol_LH) %>%
  summarize(n=n())
#make note of errors


#example code to review midfol_LH and perimenstrual_LH overlaps, if they exist
cycleday.am.merge %>%
  filter(midfol_LH==1) %>%
  filter(perimenstrual_LH==1) %>%
  select(id, daterated, posLHtoday, daycountLH,
         menstrualbleeding,
         firstdayofperiod, cycleday,
         midfol_LH, periov_LH, earlylut_LH,
         midluteal_LH, perimenstrual_LH) %>%
  View()



```                                                                        

    
#edit days that got double-counted
```{r}

cycleday.am.merge  <- cycleday.am.merge  %>%
  #if perimenstrual by firstdayofperiod and midfol by pre-LH count are both 1, perimen wins, make midfol=0
  mutate(midfol_LH = case_when(perimenstrual_LH==1 ~ 0,
                                        TRUE ~ midfol_LH)) 

#review midlut and perimens overlaps - can override midluteal with perimens IF luteal phase is short but still seems normal (such as 9-10 days)
## make notes of any SUPER short luteal phases (like 4-5 days) that you might want to flag for anovulation
cycleday.am.merge %>% filter(midluteal_LH==1 & perimenstrual_LH==1) %>% 
  select(ID, daterated, daycountLH, cycleday, midluteal_LH, perimenstrual_LH)

#code for if you are ready to override midluteals with perimens
cycleday.am.merge  <- cycleday.am.merge  %>%
  #if perimenstrual by firstdayofperiod and midlut by count after LH test are both 1, perimen wins, make midlut=0
  mutate(midluteal_LH = case_when(perimenstrual_LH==1 ~ 0,
                                        TRUE ~ midluteal_LH)) 

## ANY OTHER COMBOS need hand review!!

#good practice to review again and ensure that dummy code is fixed
cycleday.am.merge %>%
  group_by(periov_LH, earlylut_LH, midluteal_LH, perimenstrual_LH, midfol_LH) %>%
  summarize(n=n())

```                                                                        

```{r}

cycleday.pm.merge  <- cycleday.pm.merge  %>%
  #if perimenstrual by firstdayofperiod and midfol by pre-LH count are both 1, perimen wins, make midfol=0
  mutate(midfol_LH = case_when(perimenstrual_LH==1 ~ 0,
                                        TRUE ~ midfol_LH)) 

#review midlut and perimens overlaps - can override midluteal with perimens IF luteal phase is short but still seems normal (such as 9-10 days)
## make notes of any SUPER short luteal phases (like 4-5 days) that you might want to flag for anovulation
cycleday.pm.merge %>% filter(midluteal_LH==1 & perimenstrual_LH==1) %>% 
  select(ID, daterated, daycountLH, cycleday, midluteal_LH, perimenstrual_LH)

#code for if you are ready to override midluteals with perimens
cycleday.pm.merge  <- cycleday.pm.merge  %>%
  #if perimenstrual by firstdayofperiod and midlut by count after LH test are both 1, perimen wins, make midlut=0
  mutate(midluteal_LH = case_when(perimenstrual_LH==1 ~ 0,
                                        TRUE ~ midluteal_LH)) 

## ANY OTHER COMBOS need hand review!!

#good practice to review again and ensure that dummy code is fixed
cycleday.pm.merge %>%
  group_by(periov_LH, earlylut_LH, midluteal_LH, perimenstrual_LH, midfol_LH) %>%
  summarize(n=n())

```    

```{r}
cycleday.am.merge %>% write.csv("Cycleday.am.LH.menses.data.csv")
```

#Look at data to be sure the cycle phases are typical lengths. This is in the code chunks I just copy/pasted from Jordan's code. 

#as factor for each variable, then rename levels as factors - update data dictionary so you know max/min when factoring. Then do as numeric. It may automatically do numeric but double-check. 
#Calculate luteal phase by subtracting the period start date column by posov_pred column but group by person first! 





